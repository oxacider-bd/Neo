<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neo AI | Multi-Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

    <style>
        :root { --primary: #3b82f6; --bg-dark: #0b1120; --panel: #111827; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body, html { height: 100%; width: 100%; background: var(--bg-dark); color: white; overflow: hidden; }
        .app-container { display: flex; flex-direction: column; height: 100dvh; width: 100%; }
        .header { padding: 15px 20px; background: var(--panel); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .header h1 { font-size: 16px; color: var(--primary); text-transform: uppercase; letter-spacing: 1.5px; }
        #chatbox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; scrollbar-width: none; }
        .message { display: flex; gap: 12px; max-width: 85%; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .avatar { width: 35px; height: 35px; border-radius: 8px; }
        .bubble { background: #1f2937; padding: 12px 16px; border-radius: 15px; font-size: 15px; line-height: 1.5; }
        .message.user .bubble { background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .input-area { padding: 15px; background: var(--panel); }
        .input-content { display: flex; gap: 10px; background: #1f2937; padding: 8px 15px; border-radius: 30px; border: 1px solid #374151; }
        input { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 16px; }
        .send-btn { background: var(--primary); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        pre { background: #000 !important; padding: 12px; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
        #engine-tag { font-size: 10px; color: #6b7280; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>NEO SYSTEM</h1>
        <div id="engine-tag">Engine: 1 of 4</div>
    </div>
    <div id="chatbox"></div>
    <div class="input-area">
        <div class="input-content">
            <input type="text" id="userInput" placeholder="Ask anything..." autocomplete="off">
            <button class="send-btn" id="sendBtn">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    const chatbox = document.getElementById('chatbox');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const engineTag = document.getElementById('engine-tag');

    // মামা, এখানে তোর সলিড API কীগুলা বসাবি
    const apiKeys = [
        "AIzaSyB_L_888MNxzY6tzbEMX5MqubtmI7Xqt5k",
        "AIzaSyAWTPQKzVbtgL6tlX8mN8DAEr4tUvPj9Fw",
        "AIzaSyASgVjOtHEhIe8a62m39lD-ls9dhsp53bw",
        "YOUR_FOURTH_KEY" 
    ];

    let keyIndex = 0;
    let chatId = localStorage.getItem('neo_id') || "id_" + Math.random().toString(36).substring(7);
    localStorage.setItem('neo_id', chatId);

    async function fetchResponse(message) {
        for (let attempt = 0; attempt < apiKeys.length; attempt++) {
            const activeKey = apiKeys[keyIndex];
            engineTag.innerText = `Engine: ${keyIndex + 1} of ${apiKeys.length}`;

            try {
                const response = await fetch("https://neo-nwdz.onrender.com/api/v1/prediction/c8ba2b1a-3be7-4d28-8748-5664e0067ae8", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        question: message,
                        overrideConfig: {
                            sessionId: chatId,
                            googleApiKey: activeKey // Flowise 'ChatGoogleGenerativeAI' এর জন্য এই নামটাই আসল
                        }
                    })
                });

                if (response.status === 429) { // লিমিট শেষ
                    keyIndex = (keyIndex + 1) % apiKeys.length;
                    continue;
                }

                const data = await response.json();
                return data.text || data; 

            } catch (err) {
                console.error("Error with key:", keyIndex, err);
                keyIndex = (keyIndex + 1) % apiKeys.length;
            }
        }
        return "মামা, সব সার্ভারে জ্যাম! একটু পরে ট্রাই কর।";
    }

    function addMessage(text, sender) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${sender}`;
        const avatar = `<img class="avatar" src="${sender==='bot' ? 'https://i.postimg.cc/ZqkRc3gD/Neo-LOGO.png' : 'https://cdn-icons-png.flaticon.com/512/1144/1144760.png'}">`;
        msgDiv.innerHTML = avatar + `<div class="bubble">${sender==='bot' ? '' : text}</div>`;
        chatbox.appendChild(msgDiv);
        
        if(sender === 'bot') {
            let i = 0;
            const bubble = msgDiv.querySelector('.bubble');
            const interval = setInterval(() => {
                bubble.innerHTML = marked.parse(text.substring(0, i++));
                chatbox.scrollTop = chatbox.scrollHeight;
                if(i > text.length) { clearInterval(interval); Prism.highlightAll(); }
            }, 10);
        }
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    async function send() {
        const val = userInput.value.trim();
        if(!val) return;
        userInput.value = "";
        addMessage(val, 'user');
        const res = await fetchResponse(val);
        addMessage(res, 'bot');
    }

    sendBtn.onclick = send;
    userInput.onkeypress = (e) => { if(e.key==='Enter') send(); };
    window.onload = () => addMessage("Hi! আমি NEO", "bot");
</script>
</body>
</html>
